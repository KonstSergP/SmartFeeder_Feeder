# SmartFeeder_Feeder

SmartFeeder - это программа, реализующая функциональность кормушки для белок с автоматическим обнаружением белок и человеческих рук и системой удаленного управления на базе Raspberry Pi. Программа использует камеру для записи видео с белками, трансляции видео на сервер и обнаружения рук и сервопривод для управления крышкой, которая автоматически открывается при обнаружении белки или рук.

[Программа сервера](https://github.com/KonstSergP/SmartFeeder_Server)

### Основные функции:
- Автоматическое обнаружение белок и человеческих рук с использованием TensorFlow Lite и mediapipe.solutions
- Запись видео при обнаружении белок
- Открытие крышки при обнаружении белок или рук
- Потоковая передача видео на удаленный сервер
- Поддержка дневного и ночного режимов съемки, если их поддерживает камера


Компоненты системы:
- Raspberry Pi (рекомендуется 4B и мощнее)
- Камера, совместимая с Raspberry Pi (с поддержкой Picamera2)
- Сервопривод для управления крышкой кормушки
- Если камера может переходить в ночной режим, то провод, подключенный к переключателю


### Установка
```
git clone https://github.com/KonstSergP/SmartFeeder_Feeder.git

cd SmartFeeder_Feeder

make install
```

### Запуск

```
# Запустить приложение
make run

# Запустить с предварительным просмотром (для отладки)
make preview

# запуск вручную
python main.py <args>
```

### Система работает в трех основных состояниях:

- Крышка закрыта (состояние по умолчанию)

        Проверка кадров на наличие белок и рук
        При обнаружении рук - открывает крышку
        При обнаружении белки - открывает крышку и начинает запись видео

- Крышка открыта
  
        Проверка кадров на наличие рук
        Когда не обнаруживает закрывает крышку

- Запись видео

        Записывает видео, пока белка находится в кадре
        Закрывает крышку и останавливает запись, когда белка уходит
        Отправляет записанные видео на сервер

### Настройка
Настройки хранятся в файле settings.toml и могут быть изменены. Большая часть настроек может быть изменена через аргументы командной строки.
```
python main.py --help
```


### Структура проекта

- camera - модули для работы с камерой
- settings - конфигурационные файлы и парсеры аргументов
- detection - модули, отвечающие за компьютерное зрения
- feeder.py - основной класс SmartFeeder, координирующий все компоненты
- servo.py - управление сервоприводом для крышки кормушки
- server_connection.py - обработка соединения с сервером
- video_storage.py - управление записью и хранением видео
- tests - тесты для проверки программы


### Разработка и тестирование
```
# Запуск тестов с отчетом о покрытии
make coverage

# Очистка временных файлов
make clean

# Полная очистка, включая виртуальное окружение
make deepclean
```
